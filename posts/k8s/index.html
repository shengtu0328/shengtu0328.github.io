<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>K8s - rickyçš„ç½‘ç«™</title><meta name="Description" content="The best time to plant a tree was 10 years ago, the second is now"><meta property="og:title" content="K8s" />
<meta property="og:description" content="å¯åŠ¨é›†ç¾¤ minikube start minikube start &ndash;kubernetes-version=v1.23.0 æŸ¥çœ‹èŠ‚ç‚¹ã€‚kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· kubectl get node åœæ­¢é›†ç¾¤ minikube stop æ¸…ç©ºé›†ç¾¤ minikube delete &ndash;all å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å° minikube dashboard" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shengtu0328.github.io/posts/k8s/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-03T15:20:27+08:00" />
<meta property="article:modified_time" content="2023-09-03T15:20:27+08:00" /><meta property="og:site_name" content="æˆ‘çš„ç½‘ç«™" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="K8s"/>
<meta name="twitter:description" content="å¯åŠ¨é›†ç¾¤ minikube start minikube start &ndash;kubernetes-version=v1.23.0 æŸ¥çœ‹èŠ‚ç‚¹ã€‚kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· kubectl get node åœæ­¢é›†ç¾¤ minikube stop æ¸…ç©ºé›†ç¾¤ minikube delete &ndash;all å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å° minikube dashboard"/>
<meta name="application-name" content="æˆ‘çš„ç½‘ç«™">
<meta name="apple-mobile-web-app-title" content="æˆ‘çš„ç½‘ç«™"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://shengtu0328.github.io/posts/k8s/" /><link rel="prev" href="https://shengtu0328.github.io/posts/spring_session/" /><link rel="next" href="https://shengtu0328.github.io/posts/english_writing/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "K8s",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/shengtu0328.github.io\/posts\/k8s\/"
        },"genre": "posts","wordcount":  4104 ,
        "url": "https:\/\/shengtu0328.github.io\/posts\/k8s\/","datePublished": "2023-09-03T15:20:27+08:00","dateModified": "2023-09-03T15:20:27+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "ricky"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="rickyçš„ç½‘ç«™">Rickyâ€™s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="rickyçš„ç½‘ç«™">Rickyâ€™s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">K8s</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>ricky</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-09-03">2023-09-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4104 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li>
              <ul>
                <li><a href="#1ç›´æ¥å‘½ä»¤å‚æ•°-è¿è¡Œåœ¨å¯åŠ¨dokerdeskå¯åŠ¨minikubeä¹‹å-å†è¿è¡Œ">1.ç›´æ¥å‘½ä»¤å‚æ•° è¿è¡Œï¼ˆåœ¨å¯åŠ¨dokerdeskï¼Œå¯åŠ¨minikubeä¹‹å å†è¿è¡Œï¼‰</a></li>
                <li><a href="#2æŸ¥çœ‹pod"><strong>2.æŸ¥çœ‹pod</strong></a></li>
                <li><a href="#3å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œpod">3.å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œï¼ˆpodï¼‰</a></li>
                <li><a href="#4å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œdeployment">4.å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œï¼ˆDeploymentï¼‰</a></li>
                <li><a href="#5æŸ¥çœ‹-pod-è¯¦æƒ…">5.æŸ¥çœ‹ pod è¯¦æƒ…</a></li>
                <li><a href="#6æŸ¥çœ‹podçš„log">6.æŸ¥çœ‹podçš„log</a></li>
                <li><a href="#7è¿›å…¥podä¸­çš„å®¹å™¨">7.è¿›å…¥podä¸­çš„å®¹å™¨</a></li>
                <li><a href="#8-ä¼¸ç¼©æ‰©å±•å‰¯æœ¬é…ç½®æ–‡ä»¶">8. ä¼¸ç¼©æ‰©å±•å‰¯æœ¬ï¼ˆé…ç½®æ–‡ä»¶ï¼‰</a></li>
                <li><a href="#9ä¼¸ç¼©æ‰©å±•å‰¯æœ¬å‘½ä»¤è¡Œå‚æ•°">9.ä¼¸ç¼©æ‰©å±•å‰¯æœ¬ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰</a></li>
                <li><a href="#10æŠŠé›†ç¾¤å†…ç«¯å£æ˜ å°„åˆ°èŠ‚ç‚¹æŠŠpodçš„ç«¯å£æ˜ å°„åˆ°å¤–é¢">10.æŠŠé›†ç¾¤å†…ç«¯å£æ˜ å°„åˆ°èŠ‚ç‚¹ï¼ˆæŠŠpodçš„ç«¯å£æ˜ å°„åˆ°å¤–é¢ï¼‰</a></li>
                <li><a href="#11-æŸ¥çœ‹å†å²">11. æŸ¥çœ‹å†å²</a></li>
                <li><a href="#12--å›åˆ°ä¸Šä¸ªç‰ˆæœ¬ç°åº¦æ›´æ–°">12.  å›åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼ˆç°åº¦æ›´æ–°ï¼‰</a></li>
                <li><a href="#13å›åˆ°æŒ‡å®šç‰ˆæœ¬">13.å›åˆ°æŒ‡å®šç‰ˆæœ¬</a></li>
                <li><a href="#14å›åˆ°æŒ‡å®šç‰ˆæœ¬">14.å›åˆ°æŒ‡å®šç‰ˆæœ¬</a></li>
                <li><a href="#æ›´å¤šå‘½ä»¤">æ›´å¤šå‘½ä»¤</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#ç°å­˜é—®é¢˜">ç°å­˜é—®é¢˜</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ç‰¹æ€§">ç‰¹æ€§</a></li>
        <li><a href="#å¯åŠ¨-service">å¯åŠ¨ Service</a></li>
        <li><a href="#æŸ¥çœ‹æœåŠ¡">æŸ¥çœ‹æœåŠ¡</a></li>
        <li><a href="#æœåŠ¡çš„é»˜è®¤ç±»å‹æ˜¯clusteripåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æˆ‘ä»¬å¯ä»¥è¿›å…¥åˆ°-pod-é‡Œé¢è®¿é—®-æ„æ€æ˜¯è¿›å…¥åˆ°-podé‡Œé¢-å¯ä»¥è®¿é—®-sevice">æœåŠ¡çš„é»˜è®¤ç±»å‹æ˜¯<code>ClusterIP</code>ï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥åˆ° Pod é‡Œé¢è®¿é—®ï¼š æ„æ€æ˜¯è¿›å…¥åˆ° podé‡Œé¢ å¯ä»¥è®¿é—® sevice</a></li>
        <li><a href="#å¦‚æœè¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®å¯ä»¥é€šè¿‡ç«¯å£è½¬å‘å®ç°åªé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨">å¦‚æœè¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘å®ç°ï¼ˆåªé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨ï¼‰ï¼š</a></li>
        <li><a href="#å¯¹å¤–æš´éœ²æœåŠ¡">å¯¹å¤–æš´éœ²æœåŠ¡</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#éƒ¨ç½²-statefulset-ç±»å‹çš„-mongodb">éƒ¨ç½² StatefulSet ç±»å‹çš„ Mongodb</a>
          <ul>
            <li>
              <ul>
                <li><a href="#1åˆ›å»º-statefulset-é…ç½®æ–‡ä»¶mongoyamlservice-å’Œ-statefulset-éƒ½åœ¨ä¸€ä¸ªyamlé‡Œ">1.åˆ›å»º StatefulSet é…ç½®æ–‡ä»¶mongo.yamlï¼ˆservice å’Œ StatefulSet éƒ½åœ¨ä¸€ä¸ªyamlé‡Œï¼‰</a></li>
                <li><a href="#å¯åŠ¨">å¯åŠ¨</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#statefulset-ç‰¹æ€§">StatefulSet ç‰¹æ€§</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="å¯åŠ¨é›†ç¾¤">å¯åŠ¨é›†ç¾¤</h1>
<p>minikube start</p>
<p>minikube start &ndash;kubernetes-version=v1.23.0</p>
<h1 id="æŸ¥çœ‹èŠ‚ç‚¹kubectl-æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ-k8s-é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·">æŸ¥çœ‹èŠ‚ç‚¹ã€‚kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·</h1>
<p>kubectl get node</p>
<h1 id="åœæ­¢é›†ç¾¤">åœæ­¢é›†ç¾¤</h1>
<p>minikube stop</p>
<h1 id="æ¸…ç©ºé›†ç¾¤">æ¸…ç©ºé›†ç¾¤</h1>
<p>minikube delete &ndash;all</p>
<h1 id="å®‰è£…é›†ç¾¤å¯è§†åŒ–-web-ui-æ§åˆ¶å°">å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å°</h1>
<p>minikube dashboard</p>
<h1 id="éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­">éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­</h1>
<p>é¡¹ç›®åœ°å€ï¼Œé‡Œé¢åŒ…å«äº†ä¸€ä¸ªk8så¯åŠ¨podï¼Œå¯åŠ¨developmentçš„yamlæ–‡ä»¶  <a href="https://github.com/gzyunke/test-k8s" target="_blank" rel="noopener noreffer ">https://github.com/gzyunke/test-k8s</a></p>
<h5 id="1ç›´æ¥å‘½ä»¤å‚æ•°-è¿è¡Œåœ¨å¯åŠ¨dokerdeskå¯åŠ¨minikubeä¹‹å-å†è¿è¡Œ">1.ç›´æ¥å‘½ä»¤å‚æ•° è¿è¡Œï¼ˆåœ¨å¯åŠ¨dokerdeskï¼Œå¯åŠ¨minikubeä¹‹å å†è¿è¡Œï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl run testapp --image=ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œä¸€ä¸ªpod</p>
<p>podçš„åå­—æ˜¯testapp</p>
<p>é•œåƒæ˜¯  &ndash;image=ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1</p>
<h5 id="2æŸ¥çœ‹pod"><strong>2.æŸ¥çœ‹pod</strong></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get pod
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸ªå¯åŠ¨çš„è¿‡ç¨‹ READY 0/1å˜æˆ1/1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME      READY   STATUS              RESTARTS   AGE
</span></span><span class="line"><span class="cl">testapp   0/1     ContainerCreating   0          45s
</span></span><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME      READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">testapp   1/1     Running   0          77s
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œpod">3.å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œï¼ˆpodï¼‰</h5>
<p>æ‰¾åˆ°é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> kubectl apply -f .\pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod  # ç±»å‹æ˜¯Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: test-pod #Podçš„åå­—
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  # ä¸€ä¸ªpodå¯ä»¥å®šä¹‰å¤šä¸ªå®¹å™¨
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">    - name: test-k8s # å®¹å™¨åå­—
</span></span><span class="line"><span class="cl">      image: ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1 # é•œåƒ
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œdeployment">4.å¯ä»¥ç”¨å‘½ä»¤é…ç½®æ–‡ä»¶è¿è¡Œï¼ˆDeploymentï¼‰</h5>
<p>æ‰¾åˆ°é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> kubectl apply -f .\app.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: apps/v1
</span></span><span class="line"><span class="cl">kind: Deployment
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  # éƒ¨ç½²åå­—
</span></span><span class="line"><span class="cl">  name: test-k8s
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  # è¿è¡Œå‰¯æœ¬çš„æ•°é‡ï¼Œpodçš„æ•°é‡
</span></span><span class="line"><span class="cl">  replicas: 5
</span></span><span class="line"><span class="cl">  # ç”¨æ¥æŸ¥æ‰¾å…³è”çš„ Podï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½åŒ¹é…æ‰è¡Œ
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    matchLabels:
</span></span><span class="line"><span class="cl">      app: test-k8s
</span></span><span class="line"><span class="cl">  # å®šä¹‰ Pod ç›¸å…³æ•°æ®
</span></span><span class="line"><span class="cl">  template:
</span></span><span class="line"><span class="cl">    metadata:
</span></span><span class="line"><span class="cl">      labels:
</span></span><span class="line"><span class="cl">        app: test-k8s
</span></span><span class="line"><span class="cl">    spec:
</span></span><span class="line"><span class="cl">      # å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª
</span></span><span class="line"><span class="cl">      containers:
</span></span><span class="line"><span class="cl">      - name: test-k8s # å®¹å™¨åå­—
</span></span><span class="line"><span class="cl">        image: ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1 # é•œåƒ
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°replicas é…äº†å‡ ï¼Œå°±æœ‰å‡ ä¸ªpod</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   0          10m
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   0          8s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   0          8s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   0          8s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   0          8s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   0          8s
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   0          28m
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŠ ä¸Š -o wide å¯ä»¥çœ‹åˆ°podçš„ipï¼Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl get pod -o wide
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   0          14m     172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   0          3m47s   172.17.0.8   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   0          3m47s   172.17.0.7   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   0          3m47s   172.17.0.9   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   0          3m47s   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   0          3m47s   172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   0          32m     172.17.0.3   minikube   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Deployment é€šè¿‡ label å…³è”èµ·æ¥ Pods</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://sjwx.easydoc.xyz/46901064/files/kwpt8p8o.png"
        data-srcset="https://sjwx.easydoc.xyz/46901064/files/kwpt8p8o.png, https://sjwx.easydoc.xyz/46901064/files/kwpt8p8o.png 1.5x, https://sjwx.easydoc.xyz/46901064/files/kwpt8p8o.png 2x"
        data-sizes="auto"
        alt="https://sjwx.easydoc.xyz/46901064/files/kwpt8p8o.png"
        title="deployment.png" /></p>
<h5 id="5æŸ¥çœ‹-pod-è¯¦æƒ…">5.æŸ¥çœ‹ pod è¯¦æƒ…</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl describe pod pod-name
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl describe pod test-k8s-8598bbb8c6-z4dt6
</span></span><span class="line"><span class="cl">Name:             test-k8s-8598bbb8c6-z4dt6
</span></span><span class="line"><span class="cl">Namespace:        default
</span></span><span class="line"><span class="cl">Priority:         0
</span></span><span class="line"><span class="cl">Service Account:  default
</span></span><span class="line"><span class="cl">Node:             minikube/192.168.49.2
</span></span><span class="line"><span class="cl">Start Time:       Sun, 03 Sep 2023 16:08:44 +0800
</span></span><span class="line"><span class="cl">Labels:           app=test-k8s
</span></span><span class="line"><span class="cl">                  pod-template-hash=8598bbb8c6
</span></span><span class="line"><span class="cl">Annotations:      &lt;none&gt;
</span></span><span class="line"><span class="cl">Status:           Running
</span></span><span class="line"><span class="cl">IP:               172.17.0.5
</span></span><span class="line"><span class="cl">IPs:
</span></span><span class="line"><span class="cl">  IP:           172.17.0.5
</span></span><span class="line"><span class="cl">Controlled By:  ReplicaSet/test-k8s-8598bbb8c6
</span></span><span class="line"><span class="cl">Containers:
</span></span><span class="line"><span class="cl">  test-k8s:
</span></span><span class="line"><span class="cl">    Container ID:   docker://acc7370f8f643ce9ae3cad32b2e73a724b82f734990826e11cd435d20bfa7073
</span></span><span class="line"><span class="cl">    Image:          ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1
</span></span><span class="line"><span class="cl">    Image ID:       docker-pullable://ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s@sha256:9b452816d6493045a21d8b3d6a851f21ca2e50c86cd57ba8c41141f001d9911d
</span></span><span class="line"><span class="cl">    Port:           &lt;none&gt;
</span></span><span class="line"><span class="cl">    Host Port:      &lt;none&gt;
</span></span><span class="line"><span class="cl">    State:          Running
</span></span><span class="line"><span class="cl">      Started:      Sun, 03 Sep 2023 16:08:45 +0800
</span></span><span class="line"><span class="cl">    Ready:          True
</span></span><span class="line"><span class="cl">    Restart Count:  0
</span></span><span class="line"><span class="cl">    Environment:    &lt;none&gt;
</span></span><span class="line"><span class="cl">    Mounts:
</span></span><span class="line"><span class="cl">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-lm545 (ro)
</span></span><span class="line"><span class="cl">Conditions:
</span></span><span class="line"><span class="cl">  Type              Status
</span></span><span class="line"><span class="cl">  Initialized       True
</span></span><span class="line"><span class="cl">  Ready             True
</span></span><span class="line"><span class="cl">  ContainersReady   True
</span></span><span class="line"><span class="cl">  PodScheduled      True
</span></span><span class="line"><span class="cl">Volumes:
</span></span><span class="line"><span class="cl">  kube-api-access-lm545:
</span></span><span class="line"><span class="cl">    Type:                    Projected (a volume that contains injected data from multiple sources)
</span></span><span class="line"><span class="cl">    TokenExpirationSeconds:  3607
</span></span><span class="line"><span class="cl">    ConfigMapName:           kube-root-ca.crt
</span></span><span class="line"><span class="cl">    ConfigMapOptional:       &lt;nil&gt;
</span></span><span class="line"><span class="cl">    DownwardAPI:             true
</span></span><span class="line"><span class="cl">QoS Class:                   BestEffort
</span></span><span class="line"><span class="cl">Node-Selectors:              &lt;none&gt;
</span></span><span class="line"><span class="cl">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
</span></span><span class="line"><span class="cl">                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  Type    Reason     Age    From               Message
</span></span><span class="line"><span class="cl">  ----    ------     ----   ----               -------
</span></span><span class="line"><span class="cl">  Normal  Scheduled  8m58s  default-scheduler  Successfully assigned default/test-k8s-8598bbb8c6-z4dt6 to minikube
</span></span><span class="line"><span class="cl">  Normal  Pulled     8m58s  kubelet            Container image &#34;ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1&#34; already present on machine
</span></span><span class="line"><span class="cl">  Normal  Created    8m58s  kubelet            Created container test-k8s
</span></span><span class="line"><span class="cl">  Normal  Started    8m57s  kubelet            Started container test-k8s
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="6æŸ¥çœ‹podçš„log">6.æŸ¥çœ‹podçš„log</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl logs pod-name
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\WINDOWS\system32&gt; kubectl logs test-k8s-8598bbb8c6-z4dt6
</span></span><span class="line"><span class="cl">[32m[2023-09-03T08:08:46.147] [INFO] app - [39mrun in docker
</span></span><span class="line"><span class="cl">[32m[2023-09-03T08:08:46.153] [INFO] app - [39mServer started successfully and listened on 8080
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl logs pod-name -f  
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒç»­ä¸æ–­çš„æŸ¥çœ‹æ—¥å¿—</p>
<h5 id="7è¿›å…¥podä¸­çš„å®¹å™¨">7.è¿›å…¥podä¸­çš„å®¹å™¨</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl exec -it pod-name -- bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥ Pod å®¹å™¨ç»ˆç«¯ï¼Œå¦‚æœä¸€ä¸ªpodé‡Œæœ‰å¤šä¸ªå®¹å™¨ -c container-name å¯ä»¥æŒ‡å®šè¿›å…¥å“ªä¸ªå®¹å™¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS D:\minikube&gt; kubectl exec -it test-k8s-8598bbb8c6-z4dt6 -- bash
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/app# ls
</span></span><span class="line"><span class="cl">app.js  docker-compose.yml  draw  log  log.js  log4js.json  node_modules  package-lock.json  package.json  yaml
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/app# pwd
</span></span><span class="line"><span class="cl">/app
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/app# cd ..
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/# ls
</span></span><span class="line"><span class="cl">app  bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/# cd app/log
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/app/log# ls
</span></span><span class="line"><span class="cl">access  app.log  errors.log
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-z4dt6:/app/log# tail -f app.log
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:27.289] [INFO] app - on index page
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:31.337] [INFO] app - on hello page
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:32.750] [INFO] app - on hello page
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:35.918] [INFO] app - on hello page
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:39.464] [INFO] app - on hello page
</span></span><span class="line"><span class="cl">[2021-12-02T17:22:56.888] [INFO] app - on index page
</span></span><span class="line"><span class="cl">[2021-12-02T17:23:09.312] [INFO] app - on index page
</span></span><span class="line"><span class="cl">[2023-09-04T00:10:59.180] [INFO] app - run in docker
</span></span><span class="line"><span class="cl">[2023-09-04T00:10:59.186] [INFO] app - Server started successfully and listened on 8080
</span></span><span class="line"><span class="cl">http://localhost:8080
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="8-ä¼¸ç¼©æ‰©å±•å‰¯æœ¬é…ç½®æ–‡ä»¶">8. ä¼¸ç¼©æ‰©å±•å‰¯æœ¬ï¼ˆé…ç½®æ–‡ä»¶ï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl apply -f .\app.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ app.yamlä¸­æŠŠ replicas æ•°é‡ä»5ä¸ªæ”¹æˆ6ä¸ªï¼ŒæŸ¥çœ‹podæ•°é‡ä¹Ÿå‘ç”Ÿç›¸åº”çš„å˜åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (17m ago)   16h
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl apply -f .\app.yaml
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s configured
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-skz8x   1/1     Running   0             2s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   1 (18m ago)   16h
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (18m ago)   16h
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="9ä¼¸ç¼©æ‰©å±•å‰¯æœ¬å‘½ä»¤è¡Œå‚æ•°">9.ä¼¸ç¼©æ‰©å±•å‰¯æœ¬ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl scale deployment test-k8s --replicas=10
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-skz8x   1/1     Running   0             3m37s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl scale deployment test-k8s --replicas=10
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s scaled
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-8dk69   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-92k7b   1/1     Running   0             4s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-b684w   1/1     Running   0             4s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-g77gw   1/1     Running   0             4s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-hl8xj   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkdtd   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kjrfk   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-skz8x   1/1     Running   0             3m50s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-xhjzx   1/1     Running   0             4s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-z4dt6   1/1     Running   1 (21m ago)   16h
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (21m ago)   16h
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="10æŠŠé›†ç¾¤å†…ç«¯å£æ˜ å°„åˆ°èŠ‚ç‚¹æŠŠpodçš„ç«¯å£æ˜ å°„åˆ°å¤–é¢">10.æŠŠé›†ç¾¤å†…ç«¯å£æ˜ å°„åˆ°èŠ‚ç‚¹ï¼ˆæŠŠpodçš„ç«¯å£æ˜ å°„åˆ°å¤–é¢ï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl port-forward pod-name 8090:8080
</span></span></code></pre></td></tr></table>
</div>
</div><p>8090æ˜¯å¤–é¢çš„ç«¯å£ï¼Œ8080æ˜¯å®¹å™¨ç«¯å£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl port-forward test-k8s-8598bbb8c6-hl8xj 8090:8080
</span></span><span class="line"><span class="cl">Forwarding from 127.0.0.1:8090 -&gt; 8080
</span></span><span class="line"><span class="cl">Forwarding from [::1]:8090 -&gt; 8080
</span></span><span class="line"><span class="cl">Handling connection for 8090
</span></span><span class="line"><span class="cl">Handling connection for 8090
</span></span><span class="line"><span class="cl">Handling connection for 8090
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11-æŸ¥çœ‹å†å²">11. æŸ¥çœ‹å†å²</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl rollout history deployment test-k8s 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl rollout history deployment test-k8s
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s
</span></span><span class="line"><span class="cl">REVISION  CHANGE-CAUSE
</span></span><span class="line"><span class="cl">1         &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨åªæœ‰ä¸€ä¸ªå†å²ç‰ˆæœ¬</p>
<p>ä¿®æ”¹ä¸‹ app.yaml çš„é•œåƒåœ°å€ image: ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error # é•œåƒï¼Œä¼šæŠ¥é”™çš„ä¸€ä¸ªä»£ç ç‰ˆæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl apply -f .\app.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡æ–°éƒ¨ç½²ä¸‹ï¼Œç°åº¦æ›´æ–°(ç°åº¦æ›´æ–°æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªæ–°podï¼Œé”€æ¯ä¸€ä¸ªæ—§çš„pod)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (60m ago)   17h
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-2dxs2   1/1     Running   0             88s
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-9g8md   1/1     Running   0             95s
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-b5t2k   1/1     Running   0             95s
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-h4p2x   1/1     Running   0             95s
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-hj6vj   1/1     Running   0             87s
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-vqnwd   1/1     Running   0             87s
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (60m ago)   17h
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ä¸‹pod è¯¦æƒ…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl describe pod test-k8s-5dd85b6897-h4p2x
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°imageå·²ç»ä¿®æ”¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  Type    Reason     Age    From               Message
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">----    ------     ----   ----               -------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Normal  Scheduled  2m39s  default-scheduler  Successfully assigned default/test-k8s-5dd85b6897-h4p2x to minikube
</span></span><span class="line"><span class="cl">  Normal  Pulling    2m39s  kubelet            Pulling image &#34;ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error&#34;
</span></span><span class="line"><span class="cl">  Normal  Pulled     2m33s  kubelet            Successfully pulled image &#34;ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error&#34; in 6.110508402s
</span></span><span class="line"><span class="cl">  Normal  Created    2m33s  kubelet            Created container test-k8s
</span></span><span class="line"><span class="cl">  Normal  Started    2m32s  kubelet            Started container test-k8s
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ¬¡æŸ¥çœ‹å†å²</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl rollout history deployment test-k8s 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl rollout history deployment test-k8s
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s
</span></span><span class="line"><span class="cl">REVISION  CHANGE-CAUSE
</span></span><span class="line"><span class="cl">1         &lt;none&gt;
</span></span><span class="line"><span class="cl">2         &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°å·²ç»æœ‰2ä¸ªç‰ˆæœ¬äº†</p>
<p>ä¸ºäº†æ£€éªŒä¸‹æ–°ç‰ˆæœ¬çš„ä»£ç åŠŸèƒ½ï¼ŒæŠŠé›†ç¾¤å†…ç«¯å£æ˜ å°„åˆ°èŠ‚ç‚¹ï¼ˆæŠŠpodçš„ç«¯å£æ˜ å°„åˆ°å¤–é¢ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl port-forward test-k8s-5dd85b6897-b5t2k 8080:8080
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸»æœºè®¿é—®æ¥å£ http://localhost:8080/hello/aasdasd å‘ç°æ˜¯æŠ¥é”™çš„ï¼Œéœ€è¦ç´§æ€¥çš„å›é€€</p>
<h5 id="12--å›åˆ°ä¸Šä¸ªç‰ˆæœ¬ç°åº¦æ›´æ–°">12.  å›åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼ˆç°åº¦æ›´æ–°ï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl rollout undo deployment test-k8s 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl rollout undo deployment test-k8s
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s rolled back
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS              RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running             1 (73m ago)   17h
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-2dxs2   1/1     Running             0             14m
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-9g8md   1/1     Terminating         0             14m
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-b5t2k   1/1     Running             0             14m
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-h4p2x   1/1     Running             0             14m
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-hj6vj   1/1     Running             0             14m
</span></span><span class="line"><span class="cl">test-k8s-5dd85b6897-vqnwd   1/1     Terminating         0             14m
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-crjwp   0/1     ContainerCreating   0             2s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kxj4q   0/1     ContainerCreating   0             1s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-sgmnv   1/1     Running             0             2s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-wqj99   0/1     ContainerCreating   0             2s
</span></span><span class="line"><span class="cl">testapp                     1/1     Running             1 (73m ago)   17h
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">test-k8s                    1/1     Running   1 (74m ago)   17h
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-crjwp   1/1     Running   0             108s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-jkw9g   1/1     Running   0             106s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-kxj4q   1/1     Running   0             107s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-rfpfl   1/1     Running   0             106s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-sgmnv   1/1     Running   0             108s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-wqj99   1/1     Running   0             108s
</span></span><span class="line"><span class="cl">testapp                     1/1     Running   1 (74m ago)   17h
</span></span></code></pre></td></tr></table>
</div>
</div><p>è½¬å‘ä¸€ä¸ªæ–°çš„pod ï¼Œæ£€æŸ¥å…¶ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl port-forward test-k8s-8598bbb8c6-rfpfl  8080:8080
</span></span><span class="line"><span class="cl">Forwarding from 127.0.0.1:8090 -&gt; 8080
</span></span><span class="line"><span class="cl">Forwarding from [::1]:8090 -&gt; 8080
</span></span><span class="line"><span class="cl">Handling connection for 8090
</span></span><span class="line"><span class="cl">Handling connection for 8090
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸»æœºè®¿é—®æ¥å£ http://localhost:8080/hello/aasdasd å‘ç°æ˜¯æ­£å¸¸çš„ç‰ˆæœ¬äº†</p>
<p>ç°åœ¨åˆå¤šäº† 3 å·ç‰ˆæœ¬äº†ï¼Œä½†æ˜¯1å·ç‰ˆæœ¬æ²¡äº†ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\deployment&gt; kubectl rollout history deployment test-k8s
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s
</span></span><span class="line"><span class="cl">REVISION  CHANGE-CAUSE
</span></span><span class="line"><span class="cl">2         &lt;none&gt;
</span></span><span class="line"><span class="cl">3         &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="13å›åˆ°æŒ‡å®šç‰ˆæœ¬">13.å›åˆ°æŒ‡å®šç‰ˆæœ¬</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl rollout undo deployment test-k8s --to-revision=2 
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="14å›åˆ°æŒ‡å®šç‰ˆæœ¬">14.å›åˆ°æŒ‡å®šç‰ˆæœ¬</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl delete deployment test-k8s
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æ›´å¤šå‘½ä»¤">æ›´å¤šå‘½ä»¤</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æŸ¥çœ‹å…¨éƒ¨
</span></span><span class="line"><span class="cl">kubectl get all
</span></span><span class="line"><span class="cl"># é‡æ–°éƒ¨ç½²
</span></span><span class="line"><span class="cl">kubectl rollout restart deployment test-k8s
</span></span><span class="line"><span class="cl"># å‘½ä»¤ä¿®æ”¹é•œåƒï¼Œ--record è¡¨ç¤ºæŠŠè¿™ä¸ªå‘½ä»¤è®°å½•åˆ°æ“ä½œå†å²ä¸­
</span></span><span class="line"><span class="cl">kubectl set image deployment test-k8s test-k8s=ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error --record
</span></span><span class="line"><span class="cl"># æš‚åœè¿è¡Œï¼Œæš‚åœåï¼Œå¯¹ deployment çš„ä¿®æ”¹ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œæ¢å¤åæ‰åº”ç”¨è®¾ç½®
</span></span><span class="line"><span class="cl">kubectl rollout pause deployment test-k8s
</span></span><span class="line"><span class="cl"># æ¢å¤
</span></span><span class="line"><span class="cl">kubectl rollout resume deployment test-k8s
</span></span><span class="line"><span class="cl"># è¾“å‡ºåˆ°æ–‡ä»¶
</span></span><span class="line"><span class="cl">kubectl get deployment test-k8s -o yaml &gt;&gt; app2.yaml
</span></span><span class="line"><span class="cl"># åˆ é™¤å…¨éƒ¨èµ„æº
</span></span><span class="line"><span class="cl">kubectl delete all --all
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç°å­˜é—®é¢˜">ç°å­˜é—®é¢˜</h3>
<ul>
<li>æ¯æ¬¡åªèƒ½è®¿é—®ä¸€ä¸ª podï¼Œæ²¡æœ‰è´Ÿè½½å‡è¡¡è‡ªåŠ¨è½¬å‘åˆ°ä¸åŒ pod</li>
<li>è®¿é—®è¿˜éœ€è¦ç«¯å£è½¬å‘</li>
<li>Pod é‡åˆ›å IP å˜äº†ï¼Œåå­—ä¹Ÿå˜äº†</li>
</ul>
<h1 id="service">Service</h1>
<h3 id="ç‰¹æ€§">ç‰¹æ€§</h3>
<ul>
<li>Service é€šè¿‡ label å…³è”å¯¹åº”çš„ Pod</li>
<li>Servcie ç”Ÿå‘½å‘¨æœŸä¸è·Ÿ Pod ç»‘å®šï¼Œä¸ä¼šå› ä¸º Pod é‡åˆ›æ”¹å˜ IP</li>
<li>æä¾›äº†è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè‡ªåŠ¨è½¬å‘æµé‡åˆ°ä¸åŒ Pod</li>
<li>å¯å¯¹é›†ç¾¤å¤–éƒ¨æä¾›è®¿é—®ç«¯å£</li>
<li>é›†ç¾¤å†…éƒ¨å¯é€šè¿‡æœåŠ¡åå­—è®¿é—®</li>
</ul>
<h3 id="å¯åŠ¨-service">å¯åŠ¨ Service</h3>
<p>åˆ›å»º ä¸€ä¸ª Serviceï¼Œé€šè¿‡æ ‡ç­¾<code>test-k8s</code>è·Ÿå¯¹åº”çš„ Pod å…³è”ä¸Š
<code>service.yaml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Service
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: test-k8s
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    app: test-k8s   # è¦å’Œpodçš„åå­—å¯¹åº”èµ·æ¥
</span></span><span class="line"><span class="cl">  type: ClusterIP
</span></span><span class="line"><span class="cl">  ports:  # æ•°ç»„ç±»å‹ å¯ä»¥å¤šä¸ª
</span></span><span class="line"><span class="cl">    - port: 8080        # æœ¬ Service æš´éœ²çš„ç«¯å£
</span></span><span class="line"><span class="cl">      targetPort: 8080  # å®¹å™¨çš„ç«¯å£
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆå¯åŠ¨pod</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt;  kubectl apply -f .\app.yaml
</span></span><span class="line"><span class="cl">deployment.apps/test-k8s created
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†å¯åŠ¨service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl apply -f .\service.yaml
</span></span><span class="line"><span class="cl">service/test-k8s created
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-25d2c   1/1     Running   0          9m21s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-2llv2   1/1     Running   0          9m21s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-2wcgm   1/1     Running   0          9m21s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-ggljl   1/1     Running   0          9m21s
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-px5n7   1/1     Running   0          9m21s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥çœ‹æœåŠ¡">æŸ¥çœ‹æœåŠ¡</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl get service
</span></span><span class="line"><span class="cl">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
</span></span><span class="line"><span class="cl">kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP    12m
</span></span><span class="line"><span class="cl">test-k8s     ClusterIP   10.108.160.222   &lt;none&gt;        8080/TCP   44s
</span></span></code></pre></td></tr></table>
</div>
</div><p>test-k8s è¿™ä¸ªservice çš„ ip  10.108.160.22æ˜¯å›ºå®šçš„</p>
<p>ä¹Ÿå¯ä»¥ç”¨ <code>kubectl get svc</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl get svc
</span></span><span class="line"><span class="cl">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
</span></span><span class="line"><span class="cl">kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP    20m
</span></span><span class="line"><span class="cl">test-k8s     ClusterIP   10.108.160.222   &lt;none&gt;        8080/TCP   8m44s
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹æœåŠ¡è¯¦æƒ… <code>kubectl describe svc test-k8s</code>ï¼Œ test-k8sæ˜¯serviceåå­—å¯ä»¥å‘ç° Endpoints æ˜¯å„ä¸ª Pod çš„ IPï¼Œä¹Ÿå°±æ˜¯ä»–ä¼šæŠŠæµé‡è½¬å‘åˆ°è¿™äº›èŠ‚ç‚¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl describe svc test-k8s
</span></span><span class="line"><span class="cl">Name:              test-k8s
</span></span><span class="line"><span class="cl">Namespace:         default
</span></span><span class="line"><span class="cl">Labels:            &lt;none&gt;
</span></span><span class="line"><span class="cl">Annotations:       &lt;none&gt;
</span></span><span class="line"><span class="cl">Selector:          app=test-k8s
</span></span><span class="line"><span class="cl">Type:              ClusterIP
</span></span><span class="line"><span class="cl">IP Family Policy:  SingleStack
</span></span><span class="line"><span class="cl">IP Families:       IPv4
</span></span><span class="line"><span class="cl">IP:                10.108.160.222
</span></span><span class="line"><span class="cl">IPs:               10.108.160.222
</span></span><span class="line"><span class="cl">Port:              &lt;unset&gt;  8080/TCP
</span></span><span class="line"><span class="cl">TargetPort:        8080/TCP
</span></span><span class="line"><span class="cl">Endpoints:         172.17.0.2:8080,172.17.0.3:8080,172.17.0.4:8080 + 2 more...
</span></span><span class="line"><span class="cl">Session Affinity:  None
</span></span><span class="line"><span class="cl">Events:            &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl get pod -o wide
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-25d2c   1/1     Running   0          25m   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-2llv2   1/1     Running   0          25m   172.17.0.7   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-2wcgm   1/1     Running   0          25m   172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-ggljl   1/1     Running   0          25m   172.17.0.3   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">test-k8s-8598bbb8c6-px5n7   1/1     Running   0          25m   172.17.0.2   minikube   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœåŠ¡çš„é»˜è®¤ç±»å‹æ˜¯clusteripåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æˆ‘ä»¬å¯ä»¥è¿›å…¥åˆ°-pod-é‡Œé¢è®¿é—®-æ„æ€æ˜¯è¿›å…¥åˆ°-podé‡Œé¢-å¯ä»¥è®¿é—®-sevice">æœåŠ¡çš„é»˜è®¤ç±»å‹æ˜¯<code>ClusterIP</code>ï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥åˆ° Pod é‡Œé¢è®¿é—®ï¼š æ„æ€æ˜¯è¿›å…¥åˆ° podé‡Œé¢ å¯ä»¥è®¿é—® sevice</h3>
<p><code>kubectl exec -it pod-name -- bash</code>
<code>curl http://test-k8s:8080</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\service&gt; kubectl exec -it test-k8s-8598bbb8c6-ggljl -- bash
</span></span><span class="line"><span class="cl">root@test-k8s-8598bbb8c6-ggljl:/app# curl http://test-k8s:8080
</span></span><span class="line"><span class="cl">index page
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">IP lo172.17.0.4, hostname: test-k8s-8598bbb8c6-2wcgm
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¦‚æœè¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®å¯ä»¥é€šè¿‡ç«¯å£è½¬å‘å®ç°åªé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨">å¦‚æœè¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘å®ç°ï¼ˆåªé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨ï¼‰ï¼š</h3>
<p><code>kubectl port-forward service/test-k8s 8888:8080</code></p>
<blockquote>
<p>å¦‚æœä½ ç”¨ minikubeï¼Œä¹Ÿå¯ä»¥è¿™æ ·<code>minikube service test-k8s</code></p>
</blockquote>
<p>ç›´æ¥å¼¹å‡ºé¡µé¢è®¿é—®</p>
<h3 id="å¯¹å¤–æš´éœ²æœåŠ¡">å¯¹å¤–æš´éœ²æœåŠ¡</h3>
<p>ä¸Šé¢æˆ‘ä»¬æ˜¯é€šè¿‡ç«¯å£è½¬å‘çš„æ–¹å¼å¯ä»¥åœ¨å¤–é¢è®¿é—®åˆ°é›†ç¾¤é‡Œçš„æœåŠ¡ï¼Œå¦‚æœæƒ³è¦ç›´æ¥æŠŠé›†ç¾¤æœåŠ¡æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>NodePort</code> å’Œ <code>Loadbalancer</code> ç±»å‹çš„ Service</p>
<p>å°†service.yamlä¿®æ”¹ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Service
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: test-k8s
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    app: test-k8s
</span></span><span class="line"><span class="cl">  # é»˜è®¤ ClusterIP é›†ç¾¤å†…å¯è®¿é—®ï¼ŒNodePort èŠ‚ç‚¹å¯è®¿é—®ï¼ŒLoadBalancer è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰å¯ç”¨ï¼‰
</span></span><span class="line"><span class="cl">#  type: ClusterIP
</span></span><span class="line"><span class="cl">  type: NodePort
</span></span><span class="line"><span class="cl">  ports:
</span></span><span class="line"><span class="cl">    - port: 8080        # æœ¬ Serviceå¯¹å¤–æš´éœ² çš„ç«¯å£
</span></span><span class="line"><span class="cl">      targetPort: 8080  # æœåŠ¡è®¿é—®å®¹å™¨ çš„ å®¹å™¨ç«¯å£
</span></span><span class="line"><span class="cl">      nodePort: 31000   # èŠ‚ç‚¹ï¼ˆå¦‚æœæ˜¯è£¸æœºï¼Œéœ€è¦åˆ°å¯¹åº”çš„nodeèŠ‚ç‚¹ï¼‰ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨minikubeä¸­ æ˜¯è¿›å…¥dokcerä¸­çš„è¿™ä¸ªminikube å®¹å™¨ ï¼Œå¦‚æœæ˜¯è£¸æœºï¼Œéœ€è¦åˆ°å¯¹åº”çš„nodeèŠ‚ç‚¹å»è¿è¡Œè¯¥curlå‘½ä»¤</p>
<p>http://localhost:31000/</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="NodePort.png"
        data-srcset="NodePort.png, NodePort.png 1.5x, NodePort.png 2x"
        data-sizes="auto"
        alt="NodePort.png"
        title="NodePort.png" /></p>
<h1 id="statefulset">StatefulSet</h1>
<h3 id="éƒ¨ç½²-statefulset-ç±»å‹çš„-mongodb">éƒ¨ç½² StatefulSet ç±»å‹çš„ Mongodb</h3>
<h5 id="1åˆ›å»º-statefulset-é…ç½®æ–‡ä»¶mongoyamlservice-å’Œ-statefulset-éƒ½åœ¨ä¸€ä¸ªyamlé‡Œ">1.åˆ›å»º StatefulSet é…ç½®æ–‡ä»¶mongo.yamlï¼ˆservice å’Œ StatefulSet éƒ½åœ¨ä¸€ä¸ªyamlé‡Œï¼‰</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: apps/v1
</span></span><span class="line"><span class="cl">kind: StatefulSet
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: mongodb
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  serviceName: mongodb
</span></span><span class="line"><span class="cl">  replicas: 3
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    matchLabels:
</span></span><span class="line"><span class="cl">      app: mongodb
</span></span><span class="line"><span class="cl">  template:
</span></span><span class="line"><span class="cl">    metadata:
</span></span><span class="line"><span class="cl">      labels:
</span></span><span class="line"><span class="cl">        app: mongodb
</span></span><span class="line"><span class="cl">    spec:
</span></span><span class="line"><span class="cl">      containers:
</span></span><span class="line"><span class="cl">        - name: mongo
</span></span><span class="line"><span class="cl">          image: mongo:4.4
</span></span><span class="line"><span class="cl">          # IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™
</span></span><span class="line"><span class="cl">          imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Service
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: mongodb
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    app: mongodb
</span></span><span class="line"><span class="cl">  type: ClusterIP
</span></span><span class="line"><span class="cl">  # HeadLess  ä¸ä¼šåˆ†é…é›†ç¾¤çš„ipäº† ï¼Œåªèƒ½é€šè¿‡æœåŠ¡åå­—æ¥è®¿é—®
</span></span><span class="line"><span class="cl">  clusterIP: None
</span></span><span class="line"><span class="cl">  ports:
</span></span><span class="line"><span class="cl">    - port: 27017
</span></span><span class="line"><span class="cl">      targetPort: 27017
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å¯åŠ¨">å¯åŠ¨</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\statefulset&gt; kubectl apply -f mongo.yaml
</span></span><span class="line"><span class="cl">statefulset.apps/mongodb created
</span></span><span class="line"><span class="cl">service/mongodb created
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\statefulset&gt; kubectl get pod
</span></span><span class="line"><span class="cl">NAME        READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">mongodb-0   1/1     Running   0          5m30s
</span></span><span class="line"><span class="cl">mongodb-1   1/1     Running   0          4m43s
</span></span><span class="line"><span class="cl">mongodb-2   1/1     Running   0          4m41s
</span></span><span class="line"><span class="cl">PS G:\xrqProjects\test-k8s-main\yaml\statefulset&gt; kubectl get statefulset
</span></span><span class="line"><span class="cl">NAME      READY   AGE
</span></span><span class="line"><span class="cl">mongodb   3/3     7m24s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="statefulset-ç‰¹æ€§">StatefulSet ç‰¹æ€§</h3>
<ul>
<li>Service çš„ <code>CLUSTER-IP</code> æ˜¯ç©ºçš„ï¼ŒPod åå­—ä¹Ÿæ˜¯å›ºå®šçš„ã€‚</li>
<li>Pod åˆ›å»ºå’Œé”€æ¯æ˜¯æœ‰åºçš„ï¼Œåˆ›å»ºæ˜¯é¡ºåºçš„ï¼Œé”€æ¯æ˜¯é€†åºçš„ã€‚</li>
<li>Pod é‡å»ºä¸ä¼šæ”¹å˜åå­—ï¼Œé™¤äº†IPï¼Œæ‰€ä»¥ä¸è¦ç”¨IPç›´è¿</li>
</ul>
<p>è®¿é—®æ—¶ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ Service åå­—è¿æ¥ï¼Œä¼šéšæœºè½¬å‘è¯·æ±‚
è¦è¿æ¥æŒ‡å®š Podï¼Œå¯ä»¥è¿™æ ·<code>pod-name.service-name</code>
è¿è¡Œä¸€ä¸ªä¸´æ—¶ Pod è¿æ¥æ•°æ®æµ‹è¯•ä¸‹</p>
<p>kubectl run mongodb-client &ndash;rm &ndash;tty -i &ndash;restart=&lsquo;Never&rsquo; &ndash;image docker.io/bitnami/mongodb:4.4.10-debian-10-r20 &ndash;command &ndash; bash</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">I have no name!@mongodb-client:/$ mongo --host mongodb-0.mongodb
</span></span><span class="line"><span class="cl">MongoDB shell version v4.4.10
</span></span><span class="line"><span class="cl">connecting to: mongodb://mongodb-0.mongodb:27017/?compressors=disabled&amp;gssapiServiceName=mongodb
</span></span><span class="line"><span class="cl">Implicit session: session { &#34;id&#34; : UUID(&#34;2904e96c-22e9-4a6e-a969-85467c83a68f&#34;) }
</span></span><span class="line"><span class="cl">MongoDB server version: 4.4.24
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">The server generated these startup warnings when booting:
</span></span><span class="line"><span class="cl">        2023-09-04T05:31:54.964+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem
</span></span><span class="line"><span class="cl">        2023-09-04T05:31:55.667+00:00: Access control is not enabled for the database. Read and write access to data and configuration is unrestricted
</span></span><span class="line"><span class="cl">        2023-09-04T05:31:55.667+00:00: /sys/kernel/mm/transparent_hugepage/enabled is &#39;always&#39;. We suggest setting it to &#39;never&#39;
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-09-03</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://shengtu0328.github.io/posts/k8s/" data-title="K8s"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://shengtu0328.github.io/posts/k8s/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://shengtu0328.github.io/posts/k8s/" data-title="K8s"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://shengtu0328.github.io/posts/k8s/" data-title="K8s"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on å¾®åš" data-sharer="weibo" data-url="https://shengtu0328.github.io/posts/k8s/" data-title="K8s"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/spring_session/" class="prev" rel="prev" title="Spring_session"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Spring_session</a>
            <a href="/posts/english_writing/" class="next" rel="next" title="Learing English is not a rocket science.">Learing English is not a rocket science.<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0-DEV">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">ricky</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
